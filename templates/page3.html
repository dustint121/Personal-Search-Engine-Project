{% extends "base.html" %}

{% block head %}
<style>
  .layout-eliza {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .eliza-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .history-btn {
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid #d1d5db;
    background-color: #ffffff;
    font-size: 13px;
    cursor: pointer;
  }
  .history-btn:hover {
    background-color: #f3f4ff;
  }

  .chat-messages {
    max-height: 480px;
    overflow-y: auto;
    padding: 12px 8px;
    background-color: #f9fafb;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
  }
  .chat-row {
    display: flex;
    margin-bottom: 12px;
  }
  .chat-row.user {
    justify-content: flex-end;
  }
  .chat-row.ai {
    justify-content: flex-start;
  }
  .bubble-user {
    display: inline-block;
    max-width: 70%;
    padding: 8px 12px;
    border-radius: 16px;
    border-top-right-radius: 4px;
    background-color: #2563eb;
    color: #ffffff;
    font-size: 14px;
    line-height: 1.4;
    white-space: pre-wrap;
  }
  .bubble-ai {
    width: 100%;
    padding: 12px 16px;
    border-radius: 16px;
    border-top-left-radius: 4px;
    background-color: #ffffff;
    color: #111827;
    font-size: 14px;
    line-height: 1.5;
    white-space: pre-wrap;
    box-sizing: border-box;
    box-shadow: 0 1px 2px rgba(15,23,42,0.08);
    position: relative;
  }

  .chat-input-area {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .chat-textarea {
    width: 98%;
    max-width: 100%;
    min-height: 80px;
    max-height: 200px;
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    font-size: 14px;
    resize: vertical;
    box-sizing: border-box;
  }
  .chat-actions {
    display: flex;
    justify-content: flex-end;
    align-items: center;
  }
  .chat-btn {
    padding: 8px 14px;
    border-radius: 4px;
    border: none;
    background-color: #1a73e8;
    color: #ffffff;
    font-size: 14px;
    cursor: pointer;
  }
  .error-text {
    font-size: 13px;
    color: #b91c1c;
  }

  /* History modal */
  .history-backdrop {
    position: fixed;
    inset: 0;
    background-color: rgba(0,0,0,0.4);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1200;
  }
  .history-backdrop.show {
    display: flex;
  }
  .history-box {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 8px;
    max-width: 720px;
    width: 95%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    font-size: 14px;
  }
  .history-box h2 {
    margin-top: 0;
    margin-bottom: 8px;
  }
  .history-section-title {
    font-weight: 600;
  }
  .history-box ul {
    margin-top: 4px;
    margin-bottom: 12px;
    padding-left: 20px;
  }
</style>
{% endblock %}

{% block content %}
<div class="box">
  <div class="layout-eliza">
    <div class="eliza-header-row">
      <h1 style="margin: 0 auto; text-align: center; flex: 1;">
        ELIZA‑Style Chatbot
      </h1>
      <button id="btn-history" class="history-btn">
        Brief History of Chatbots
      </button>
    </div>

    <div id="eliza-messages" class="chat-messages"></div>

    <div class="chat-input-area">
      <textarea id="eliza-input" class="chat-textarea"
                placeholder="Talk to the ELIZA-style chatbot. (Enter = send, Shift+Enter = newline)"></textarea>
      <div class="chat-actions">
        <button id="eliza-send" class="chat-btn">Send</button>
      </div>
      <div id="eliza-error" class="error-text"></div>
    </div>
  </div>
</div>

<!-- History modal -->
<div id="history-modal" class="history-backdrop">
  <div class="history-box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <h2>Brief History of Chatbots</h2>
      <button id="history-close" class="modal-close" style="border:none;background:none;font-size:18px;cursor:pointer;">×</button>
    </div>

    <p>
      Chatbots began as simple pattern-matching programs inspired by early ideas about machine intelligence and have evolved into large language models that generate fluent, context-aware text but still do not “understand” in a human sense.
    </p>

    <p class="history-section-title">Early foundations: Turing Test</p>
    <ul>
      <li>In 1950, Alan Turing proposed the Turing Test as a way to evaluate machine intelligence: if a text-only conversation with a machine is indistinguishable from one with a human, the machine could be considered intelligent.</li>
      <li>This idea shaped chatbot research for decades, inspiring systems designed to “fool” human judges in conversation competitions such as the Loebner Prize.</li>
    </ul>

    <p class="history-section-title">ELIZA: keyword-based pioneer</p>
    <ul>
      <li>ELIZA was created by Joseph Weizenbaum at MIT around 1966 and is widely recognized as the first chatbot, famous for its DOCTOR script that mimicked a Rogerian psychotherapist.</li>
      <li>It used simple pattern matching on keywords and template-based substitutions, giving an illusion of empathy but with no representation of meaning; its limitations became obvious in longer or off-script conversations.</li>
    </ul>

    <p class="history-section-title">Rule-based era: ALICE and others</p>
    <ul>
      <li>A.L.I.C.E. (Artificial Linguistic Internet Computer Entity), created by Richard Wallace in the mid‑1990s, extended the ELIZA approach using a rule-based system defined in AIML (Artificial Intelligence Markup Language).</li>
      <li>These rule-based chatbots depended on large sets of handcrafted patterns and responses, which made them brittle: they lacked generalization, struggled with unexpected phrasing, and did not possess genuine understanding, only scripted mappings from input to output.</li>
    </ul>

    <p class="history-section-title">Early AI-learning chatbots: Jabberwacky</p>
    <ul>
      <li>Jabberwacky, started by Rollo Carpenter in the late 1980s and put online in the 1990s, was one of the first chatbots to explicitly learn from real user interactions rather than relying purely on a fixed rule base.</li>
      <li>It stored and reused human-generated replies, using techniques like contextual pattern matching, representing an early move toward data-driven, AI-based conversational behavior instead of entirely preauthored rules.</li>
    </ul>

    <p class="history-section-title">Modern LLM-based assistants</p>
    <ul>
      <li>Modern systems such as ChatGPT and Google’s Gemini are built on large language models trained on vast text corpora, allowing them to generate contextually relevant, multi-turn responses, integrate knowledge, and handle open-domain queries far beyond classic rule-based chatbots.</li>
      <li>Despite being “AI-based,” these models still operate through learned statistical patterns over text rather than grounded semantic understanding; they outperform rule-based systems in flexibility and coverage but can hallucinate facts and lack true comprehension of the subject matter or real-world consequences.</li>
    </ul>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const messagesEl = document.getElementById("eliza-messages");
  const inputEl = document.getElementById("eliza-input");
  const sendBtn = document.getElementById("eliza-send");
  const errorEl = document.getElementById("eliza-error");

  const historyModalEl = document.getElementById("history-modal");
  const historyOpenBtn = document.getElementById("btn-history");
  const historyCloseBtn = document.getElementById("history-close");

  let elizaMessages = [
    {
      sender: "ai",
      text: "ELIZA: How do you do. Please tell me your problem.",
    }
  ];
  let isSending = false;

  function renderElizaMessages() {
    messagesEl.innerHTML = "";
    elizaMessages.forEach(msg => {
      const row = document.createElement("div");
      row.className = "chat-row " + (msg.sender === "user" ? "user" : "ai");

      const bubble = document.createElement("div");
      bubble.className = msg.sender === "user" ? "bubble-user" : "bubble-ai";
      bubble.textContent = msg.text;

      row.appendChild(bubble);
      messagesEl.appendChild(row);
    });
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  async function sendEliza() {
    const text = inputEl.value.trim();
    if (!text || isSending) {
      return;
    }
    isSending = true;
    errorEl.textContent = "";

    elizaMessages.push({sender: "user", text});
    renderElizaMessages();
    inputEl.value = "";

    try {
      const resp = await fetch("/api/eliza-chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: text}),
      });
      const data = await resp.json();
      if (resp.status !== 200 || data.error) {
        errorEl.textContent = data.error || "Unknown error";
      } else {
        elizaMessages.push({sender: "ai", text: "ELIZA: " + (data.reply || "")});
        renderElizaMessages();
      }
    } catch (err) {
      errorEl.textContent = "Unexpected error: " + err;
    } finally {
      isSending = false;
    }
  }

  sendBtn.addEventListener("click", sendEliza);
  inputEl.addEventListener("keydown", (event) => {
    if (event.key === "Enter" && !event.shiftKey) {
      event.preventDefault();
      sendEliza();
    }
  });

  function openHistory() {
    historyModalEl.classList.add("show");
  }
  function closeHistory() {
    historyModalEl.classList.remove("show");
  }

  historyOpenBtn.addEventListener("click", openHistory);
  historyCloseBtn.addEventListener("click", closeHistory);
  historyModalEl.addEventListener("click", (e) => {
    if (e.target === historyModalEl) {
      closeHistory();
    }
  });

  renderElizaMessages();
</script>
{% endblock %}
